\subsection{The Backend Software Stack}
The backend software stack will be responsible for collecting data from the
sensor nodes and displaying the air quality data on webpage. It will also be
responsible for sending alerts via text or on Twitter about poor air quality
conditions. It will be the main way users will interact with their deployed
sensors and view data. The backend will also allow users to manage, configure,
and send commands to the sensor nodes remotely. The backend is composed of three
main components: (1) the LoRaWAN gateways running the LoRaWAN Network Server,
(2) a server running on an IoT host provider that can collate data from the
gateways and provide other backend services, and (3) a web user interface
running on the IoT backend provider (such as AWS IoT or Azure IoT) that displays
statistics and user specific information. Additionally, the LNS can optionally
be ran in the cloud. In this scenario, the gateway runs a LoRa packet forwarder
that understands the LNS protocol. Packets can be forwarded to the LNS data
endpoint server, and the gateway is managed through a configuration and update
server (CUPS) using the CUPS protocol along with HTTPS. While the following
software solutions offer support for LoRaWAN versions 1.0.x and 1.1, since the
chosen LoRa module only supports up to 1.0.3, the following discussions will be
with LoRaWAN 1.0.3 as there are some differences with the architecture. The
changes are in regard to the process of join the network. 

There are two types of LoRaWAN networks: public and private. Public networks are
networks akin to Verizon or AT\&T. They provide coverage and networking. Two of
the biggest LoRaWAN public networks are The Things Network and The Helium
Network. Once registered on the network, LoRaWAN devices can operate with the
developer's application server which is configured during registration. The
other option is to configure a private network. When creating a private network,
there are generally two main architectures to choose between in order to route
packets to an application server. The first option, which will be referenced as
local-LNS, is to run the entire LNS on a gateway device. This means that the
gateway needs to manage more information about the end-devices and the state of
the network. The second option, cloud-LNS, is where the gateway operates purely
as an access point, and forwards packets to a LNS in the cloud.  This offers
greater scalability and lower compute and power requirements of the gateway
device at the expense of added complexity. Luckily, there are many solutions
available through service providers, such as AWS.

\subsubsection{LoRa Packet Forwarding}

\subsubsection{LoRaWAN Network Servers} The sensor nodes communicate over LoRa
using the LoRaWAN protocol to gateways.  These gateways are running what is
called the LoRaWAN Network Server (LNS), which is a standardized protocol for
connecting devices using LoRaWAN to the internet.  LoRaWAN network servers are
the bridge between LoRa and the Internet.  LoRa network servers can be public or
private, and end-devices must first be registered on the network before it can
join it. All packets sent by an unregistered and unverified end-device will be
discarded. As previously mentioned in the LoRaWAN standardization section,
devices communicating over LoRaWAN perform a handshake (joining the network),
and exchange a set of IDs that identify the device, the join server, and the
application/network session. These IDs are: DevEUI, JoinEUI (known previously as
the AppEUI), and AppKey, respectively. The remainder of the keys are generated
from this set of keys. The AppKey is the only key that isn't transmitted over
the network, and is stored on both the end-device and the network server. For
LoRaWAN 1.1+, an additional key is required to be stored on the end-device and
the network server: the NwkKey. The NwkKey is like the AppKey in that it is
never transferred and is used as an extra encryption layer. The network server
will need to be integrated and capable of communication with the application
server, which in for the project, will either be Amazon AWS or Microsoft Azure.
For public networks, which are basically like Verizon or AT\&T for LoRa, the
network server software is provided to users who want to setup a gateway. Once
setup, anyone with reception will be able to use the network. The Things Network
is a free, public network. Users that create a gateway are not financially
incentivised, but only are if they have a end-device they would like to use in
their area. On the other hand, The Helium Network provides financial incentives
without a central authority through a specialized blockchain. For people and
companies that would like to setup a private network, an open-source network
server, called Chipstack, is available.


\paragraph{The Chirpstack Network Server Stack}

\subsubsection{Public Networks} \label{public-networks}
\paragraph{The Things Community Network}
\paragraph{The Helium Network}

\subsubsection{Application Service Providers}
\paragraph{Microsoft Azure}
\paragraph{Amazon AWS}

\subsubsection{The Web Application Software Stack}

